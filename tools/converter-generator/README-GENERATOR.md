# Converter Generator

Stable converter generator for Kinde .NET SDK that generates Newtonsoft.Json converters for C# models with Option<> properties.

## Features

- ✅ **Type-safe**: Full type hints and dataclasses
- ✅ **Template-based**: Jinja2 templates for maintainable code generation
- ✅ **Configuration**: YAML config file support
- ✅ **Comprehensive**: Handles all property types (string, enum, List<>, Dictionary<>, Object)
- ✅ **Robust**: C# reserved keyword escaping, nested generics support
- ✅ **Tested**: Unit tests based on production requirements
- ✅ **Stable**: Proven parsing logic with better structure

## Setup

1. **Create virtual environment:**
   ```bash
   ./setup-venv.sh
   source venv/bin/activate
   ```

2. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

## Usage

### Generate All Converters

```bash
python generate_converters.py --config config.yaml
```

### With Validation

```bash
python generate_converters.py --config config.yaml --validate
```

### With Verbose Output

```bash
python generate_converters.py --config config.yaml --verbose
```

### Custom Directories

```bash
python generate_converters.py \
  --model-dir Kinde.Api/Model \
  --converter-dir Kinde.Api/Converters \
  --config config.yaml
```

## Configuration

Edit `config.yaml` to:
- Exclude specific models from generation
- Configure directories
- Enable/disable validation
- Control which model types to generate

## Testing

Run unit tests:

```bash
# All tests
pytest tests/ -v

# Specific test file
pytest tests/test_parser.py -v

# With coverage
pytest tests/ --cov=generate_converters --cov-report=html
```

## Manually Maintained Converters

The following converters are manually maintained and should NOT be regenerated:

- `CustomEnumConverter.cs` - Generic enum converters used across all models

These are excluded in `config.yaml` and will be skipped during generation.

## Generated Converters

All converters in `Kinde.Api/Converters/` (except manually maintained ones) are generated by this script. They can be safely regenerated at any time.

## Requirements

- Python 3.11+
- Virtual environment (venv)
- Dependencies from `requirements.txt`

## Architecture

- **Parser** (`CSharpModelParser`): Extracts properties from C# model files
- **Generator** (`ConverterGenerator`): Generates C# converter code using Jinja2 templates
- **Validator** (`ConverterValidator`): Validates generated converter structure
- **CLI** (`main`): Command-line interface using Click

## Production Requirements

The generator is tested against production Kinde requirements:

1. ✅ Must extract Option<> properties correctly
2. ✅ Must extract required (non-Option) parameters
3. ✅ Must handle nested generics (List<>, Dictionary<>)
4. ✅ Must escape C# reserved keywords
5. ✅ Must find JSON property names from [JsonPropertyName] attributes
6. ✅ Must handle nullable types correctly
7. ✅ Must generate valid C# code that compiles
8. ✅ Must use PascalCase for property access in WriteJson
9. ✅ Must use camelCase for constructor parameters in ReadJson
10. ✅ Must preserve JSON property names (snake_case)

